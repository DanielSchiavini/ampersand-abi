<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=CP850">
<style type="text/css">
span.lineno { color: white; background: #aaaaaa; border-right: solid white 12px }
span.nottickedoff { background: yellow}
span.istickedoff { background: white }
span.tickonlyfalse { margin: -1px; border: 1px solid #f20913; background: #f20913 }
span.tickonlytrue  { margin: -1px; border: 1px solid #60de51; background: #60de51 }
span.funcount { font-size: small; color: orange; z-index: 2; position: absolute; right: 20 }
span.decl { font-weight: bold }
span.spaces    { background: white }
</style>
</head>
<body>
<pre>
<span class="lineno">    1 </span>{-# OPTIONS_GHC -XFlexibleInstances #-}
<span class="lineno">    2 </span>module Database.Design.Ampersand.FSpec.ShowHS (ShowHS(..),ShowHSName(..),fSpec2Haskell,haskellIdentifier) where
<span class="lineno">    3 </span>import Database.Design.Ampersand.Core.ParseTree
<span class="lineno">    4 </span>import Database.Design.Ampersand.Core.AbstractSyntaxTree
<span class="lineno">    5 </span>import Text.Pandoc hiding (Meta)
<span class="lineno">    6 </span>import Data.Char                  (isAlphaNum)
<span class="lineno">    7 </span>import Database.Design.Ampersand.Basics hiding (indent)
<span class="lineno">    8 </span>import Database.Design.Ampersand.FSpec.Plug
<span class="lineno">    9 </span>import Database.Design.Ampersand.FSpec.FSpec
<span class="lineno">   10 </span>import Database.Design.Ampersand.FSpec.ShowADL    (ShowADL(..))  -- for traceability, we generate comments in the Haskell code.
<span class="lineno">   11 </span>--import Database.Design.Ampersand.FSpec.FPA   (fpa)
<span class="lineno">   12 </span>import Data.List
<span class="lineno">   13 </span>import Database.Design.Ampersand.Classes
<span class="lineno">   14 </span>import Database.Design.Ampersand.Misc
<span class="lineno">   15 </span>import Data.Hashable
<span class="lineno">   16 </span>import Data.Ord
<span class="lineno">   17 </span>import Data.Function
<span class="lineno">   18 </span>
<span class="lineno">   19 </span>fatal :: Int -&gt; String -&gt; a
<span class="lineno">   20 </span><span class="decl"><span class="nottickedoff">fatal = fatalMsg &quot;FSpec.ShowHS&quot;</span></span>
<span class="lineno">   21 </span>
<span class="lineno">   22 </span>fSpec2Haskell :: FSpec -&gt; String
<span class="lineno">   23 </span><span class="decl"><span class="nottickedoff">fSpec2Haskell fSpec</span>
<span class="lineno">   24 </span><span class="spaces">        </span><span class="nottickedoff">= &quot;{-# OPTIONS_GHC -Wall #-}&quot;</span>
<span class="lineno">   25 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\n{-Generated code by &quot;++ampersandVersionStr++&quot; at &quot;++show (genTime (getOpts fSpec))++&quot;-}&quot;</span>
<span class="lineno">   26 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nmodule Main where\n&quot;</span>
<span class="lineno">   27 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nimport Database.Design.Ampersand&quot;</span>
<span class="lineno">   28 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nimport Text.Pandoc hiding (Meta)&quot;</span>
<span class="lineno">   29 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nimport Prelude hiding (writeFile,readFile,getContents,putStr,putStrLn)&quot;</span>
<span class="lineno">   30 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\n&quot;</span>
<span class="lineno">   31 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nmain :: IO ()&quot;</span>
<span class="lineno">   32 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nmain = do (getOpts fSpec) &lt;- getOptions&quot;</span>
<span class="lineno">   33 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\n          putStr (showHS (getOpts fSpec) \&quot;\\n  \&quot; fSpec_&quot;++baseName (getOpts fSpec)++&quot;)\n&quot;</span>
<span class="lineno">   34 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nfSpec_&quot;++baseName (getOpts fSpec)++&quot; :: FSpec&quot;</span>
<span class="lineno">   35 </span><span class="spaces">          </span><span class="nottickedoff">++&quot;\nfSpec_&quot;++baseName (getOpts fSpec)++&quot; =\n  &quot;++showHS (getOpts fSpec) &quot;\n  &quot; fSpec</span></span>
<span class="lineno">   36 </span>
<span class="lineno">   37 </span>wrap :: String-&gt;String-&gt;(String-&gt;a-&gt;String)-&gt;[a]-&gt;String
<span class="lineno">   38 </span><span class="decl"><span class="nottickedoff">wrap initStr indent f xs</span>
<span class="lineno">   39 </span><span class="spaces"> </span><span class="nottickedoff">= initStr++</span>
<span class="lineno">   40 </span><span class="spaces">   </span><span class="nottickedoff">case xs of</span>
<span class="lineno">   41 </span><span class="spaces">     </span><span class="nottickedoff">[]  -&gt; &quot;[]&quot;</span>
<span class="lineno">   42 </span><span class="spaces">     </span><span class="nottickedoff">[x] -&gt; &quot;[ &quot;++f (indent++&quot;  &quot;) x++&quot; ]&quot;</span>
<span class="lineno">   43 </span><span class="spaces">     </span><span class="nottickedoff">_   -&gt; &quot;[ &quot;++intercalate (indent++&quot;, &quot;) [f (indent++&quot;  &quot;) x | x&lt;-xs]++indent++&quot;]&quot;</span></span>
<span class="lineno">   44 </span>
<span class="lineno">   45 </span>class ShowHSName a where
<span class="lineno">   46 </span> showHSName :: a -&gt; String
<span class="lineno">   47 </span>
<span class="lineno">   48 </span>class ShowHS a where
<span class="lineno">   49 </span> showHS :: Options -&gt; String -&gt; a -&gt; String
<span class="lineno">   50 </span>
<span class="lineno">   51 </span>instance ShowHSName a =&gt; ShowHSName [a] where
<span class="lineno">   52 </span> <span class="decl"><span class="nottickedoff">showHSName xs = &quot;[&quot;++intercalate &quot;,&quot; (map showHSName xs)++&quot;]&quot;</span></span>
<span class="lineno">   53 </span>
<span class="lineno">   54 </span>instance ShowHS a =&gt; ShowHS [a] where
<span class="lineno">   55 </span> <span class="decl"><span class="nottickedoff">showHS opts indent = wrap &quot;&quot; (indent++&quot; &quot;) (showHS opts)</span></span>
<span class="lineno">   56 </span>
<span class="lineno">   57 </span>instance ShowHSName a =&gt; ShowHSName (Maybe a) where
<span class="lineno">   58 </span> <span class="decl"><span class="nottickedoff">showHSName Nothing  = &quot;Nothing&quot;</span>
<span class="lineno">   59 </span><span class="spaces"> </span><span class="nottickedoff">showHSName (Just x) = showHSName x</span></span>
<span class="lineno">   60 </span>
<span class="lineno">   61 </span>instance ShowHS a =&gt; ShowHS (Maybe a) where
<span class="lineno">   62 </span> <span class="decl"><span class="nottickedoff">showHS _ _ Nothing  = &quot;Nothing&quot;</span>
<span class="lineno">   63 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (Just x) = &quot;Just (&quot; ++ showHS opts indent x ++ &quot;)&quot;</span></span>
<span class="lineno">   64 </span>
<span class="lineno">   65 </span>instance (ShowHSName a , ShowHSName b) =&gt; ShowHSName (a,b) where
<span class="lineno">   66 </span> <span class="decl"><span class="nottickedoff">showHSName (a,b) = &quot;( &quot;++showHSName a++&quot; , &quot;++showHSName b++&quot; )&quot;</span></span>
<span class="lineno">   67 </span>-- | The following is used to showHS opts for signs: (Concept, Concept)
<span class="lineno">   68 </span>--   instance (ShowHS a , ShowHS b) =&gt; ShowHS (a,b) where
<span class="lineno">   69 </span>--    showHS opts indent (a,b) = &quot;(&quot;++showHS opts (indent++&quot; &quot;) a++&quot;,&quot;++showHS opts (indent++&quot; &quot;) b++&quot;)&quot;
<span class="lineno">   70 </span>
<span class="lineno">   71 </span>instance ShowHSName PlugSQL where
<span class="lineno">   72 </span> <span class="decl"><span class="nottickedoff">showHSName plug = haskellIdentifier (&quot;plug_&quot;++name plug)</span></span>
<span class="lineno">   73 </span>
<span class="lineno">   74 </span>instance ShowHS PlugSQL where
<span class="lineno">   75 </span> <span class="decl"><span class="nottickedoff">showHS opts indent plug</span>
<span class="lineno">   76 </span><span class="spaces">   </span><span class="nottickedoff">= case plug of</span>
<span class="lineno">   77 </span><span class="spaces">       </span><span class="nottickedoff">TblSQL{} -&gt; intercalate indent</span>
<span class="lineno">   78 </span><span class="spaces">                   </span><span class="nottickedoff">[&quot;let &quot; ++ intercalate (indent++&quot;    &quot;)</span>
<span class="lineno">   79 </span><span class="spaces">                                          </span><span class="nottickedoff">[showHSName f++indent++&quot;     = &quot;++showHS opts (indent++&quot;       &quot;) f | f&lt;-fields plug] ++indent++&quot;in&quot;</span>
<span class="lineno">   80 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;TblSQL { sqlname = &quot; ++ (show.name) plug</span>
<span class="lineno">   81 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       , fields  = [&quot;++intercalate &quot;, &quot; (map showHSName (fields plug))++&quot;]&quot;</span>
<span class="lineno">   82 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       , cLkpTbl = [ &quot;++intercalate (indent++&quot;                   , &quot;) [&quot;(&quot;++showHSName c++&quot;, &quot;++showHSName cn++&quot;)&quot; | (c,cn)&lt;-cLkpTbl plug] ++ &quot;]&quot;</span>
<span class="lineno">   83 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       , mLkpTbl = [ &quot;++intercalate (indent++&quot;                   , &quot;) [&quot;(&quot;++showHS opts &quot;&quot; r++&quot;, &quot;++showHSName ms++&quot;, &quot;++showHSName mt++&quot;)&quot; | (r,ms,mt)&lt;-mLkpTbl plug] ++ &quot;]&quot;</span>
<span class="lineno">   84 </span><span class="spaces">               </span><span class="nottickedoff">--    ,&quot;       , sqlfpa  = &quot; ++ showHS opts &quot;&quot; (fpa plug)</span>
<span class="lineno">   85 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       }&quot;</span>
<span class="lineno">   86 </span><span class="spaces">                   </span><span class="nottickedoff">]</span>
<span class="lineno">   87 </span><span class="spaces">       </span><span class="nottickedoff">BinSQL{} -&gt; intercalate indent</span>
<span class="lineno">   88 </span><span class="spaces">                   </span><span class="nottickedoff">[&quot;let &quot; ++ showHSName (fst (columns plug))++indent++&quot;     = &quot;++showHS opts (indent++&quot;       &quot;) (fst (columns plug))</span>
<span class="lineno">   89 </span><span class="spaces">                           </span><span class="nottickedoff">++ (indent++&quot;    &quot;) ++ showHSName (snd (columns plug))++indent++&quot;     = &quot;++showHS opts (indent++&quot;       &quot;) (snd (columns plug))</span>
<span class="lineno">   90 </span><span class="spaces">                           </span><span class="nottickedoff">++indent++&quot;in&quot;</span>
<span class="lineno">   91 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;BinSQL { sqlname = &quot; ++ (show.name) plug</span>
<span class="lineno">   92 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       , columns = (&quot;++showHSName (fst (columns plug))++ &quot;, &quot; ++showHSName (snd (columns plug))++&quot;)&quot;</span>
<span class="lineno">   93 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       , cLkpTbl = [ &quot;++intercalate (indent++&quot;                   , &quot;) [&quot;(&quot;++showHSName c++&quot;, &quot;++showHSName cn++&quot;)&quot; | (c,cn)&lt;-cLkpTbl plug] ++ &quot;]&quot;</span>
<span class="lineno">   94 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       , mLkp = &quot;++showHS opts &quot;&quot; (mLkp plug)</span>
<span class="lineno">   95 </span><span class="spaces">               </span><span class="nottickedoff">--    ,&quot;       , sqlfpa  = &quot; ++ showHS opts &quot;&quot; (fpa plug)</span>
<span class="lineno">   96 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;       }&quot;</span>
<span class="lineno">   97 </span><span class="spaces">                   </span><span class="nottickedoff">]</span>
<span class="lineno">   98 </span><span class="spaces">       </span><span class="nottickedoff">ScalarSQL{} -&gt; intercalate indent</span>
<span class="lineno">   99 </span><span class="spaces">                   </span><span class="nottickedoff">[&quot;ScalarSQL { sqlname   = &quot;++ (show.name) plug</span>
<span class="lineno">  100 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;          , sqlColumn = &quot;++ showHS opts (indent++&quot;                     &quot;) (sqlColumn plug)</span>
<span class="lineno">  101 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;          , cLkp      = &quot;++ showHSName (cLkp plug)</span>
<span class="lineno">  102 </span><span class="spaces">               </span><span class="nottickedoff">--    ,&quot;          , sqlfpa    = &quot;++ showHS opts &quot;&quot; (fpa plug)</span>
<span class="lineno">  103 </span><span class="spaces">                   </span><span class="nottickedoff">,&quot;          }&quot;</span>
<span class="lineno">  104 </span><span class="spaces">                   </span><span class="nottickedoff">]</span></span>
<span class="lineno">  105 </span>
<span class="lineno">  106 </span>instance ShowHSName (ECArule) where
<span class="lineno">  107 </span> <span class="decl"><span class="nottickedoff">showHSName r = &quot;ecaRule&quot;++show (ecaNum r)</span></span>
<span class="lineno">  108 </span>
<span class="lineno">  109 </span>instance ShowHS (ECArule) where
<span class="lineno">  110 </span> <span class="decl"><span class="nottickedoff">showHS opts indent r</span>
<span class="lineno">  111 </span><span class="spaces">   </span><span class="nottickedoff">=         &quot;ECA { ecaTriggr = &quot; ++ showHS opts &quot;&quot; (ecaTriggr r) ++</span>
<span class="lineno">  112 </span><span class="spaces">     </span><span class="nottickedoff">indent++&quot;    , ecaDelta  = &quot; ++ showHSName (ecaDelta r)++</span>
<span class="lineno">  113 </span><span class="spaces">     </span><span class="nottickedoff">indent++&quot;    , ecaAction = &quot; ++ showHS opts (indent++&quot;                  &quot;)  (ecaAction r)++</span>
<span class="lineno">  114 </span><span class="spaces">     </span><span class="nottickedoff">indent++&quot;    , ecaNum    = &quot; ++ show (ecaNum r)++</span>
<span class="lineno">  115 </span><span class="spaces">     </span><span class="nottickedoff">indent++&quot;    }&quot;</span></span>
<span class="lineno">  116 </span>
<span class="lineno">  117 </span>instance ShowHS Event where
<span class="lineno">  118 </span> <span class="decl"><span class="nottickedoff">showHS _ indent e</span>
<span class="lineno">  119 </span><span class="spaces">   </span><span class="nottickedoff">= if &quot;\n&quot; `isPrefixOf` indent</span>
<span class="lineno">  120 </span><span class="spaces">     </span><span class="nottickedoff">then &quot;On &quot; ++ show (eSrt e)++indent++&quot;   &quot; ++ showHSName (eDcl e)++indent++&quot;   &quot;</span>
<span class="lineno">  121 </span><span class="spaces">     </span><span class="nottickedoff">else &quot;On &quot; ++ show (eSrt e)++          &quot; &quot; ++ showHSName (eDcl e)++           &quot;&quot;</span></span>
<span class="lineno">  122 </span>
<span class="lineno">  123 </span>instance ShowHS (InsDel, Expression, PAclause) where
<span class="lineno">  124 </span> <span class="decl"><span class="nottickedoff">showHS opts indent (tOp, links, p)</span>
<span class="lineno">  125 </span><span class="spaces">   </span><span class="nottickedoff">= &quot;( &quot;++show tOp++indent++&quot;, &quot;++showHS opts (indent++&quot;  &quot;) links++indent++&quot;, &quot;++showHS opts (indent++&quot;  &quot;) p++indent++&quot;)&quot;</span></span>
<span class="lineno">  126 </span>
<span class="lineno">  127 </span>instance ShowHS PAclause where
<span class="lineno">  128 </span> <span class="decl"><span class="nottickedoff">showHS opts indent p</span>
<span class="lineno">  129 </span><span class="spaces">   </span><span class="nottickedoff">= case p of</span>
<span class="lineno">  130 </span><span class="spaces">        </span><span class="nottickedoff">CHC{} -&gt; wrap &quot;CHC &quot; (indent ++&quot;    &quot;) (showHS opts) (paCls p)++</span>
<span class="lineno">  131 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  132 </span><span class="spaces">        </span><span class="nottickedoff">GCH{} -&gt; wrap &quot;GCH &quot; (indent ++&quot;    &quot;) (showHS opts) (paGCls p)++</span>
<span class="lineno">  133 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  134 </span><span class="spaces">        </span><span class="nottickedoff">ALL{} -&gt; wrap &quot;ALL &quot; (indent ++&quot;    &quot;) (showHS opts) (paCls p)++</span>
<span class="lineno">  135 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  136 </span><span class="spaces">        </span><span class="nottickedoff">Do{}  -&gt;  &quot;Do &quot;++show (paSrt p)++&quot; &quot;++showHSName (paTo p)++</span>
<span class="lineno">  137 </span><span class="spaces">                         </span><span class="nottickedoff">indent++&quot;       (&quot;++showHS opts (indent++&quot;        &quot;) (paDelta p)++indent++&quot;       )&quot;++</span>
<span class="lineno">  138 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  139 </span><span class="spaces">        </span><span class="nottickedoff">New{} -&gt; &quot;New (&quot;++showHS opts &quot;&quot; (paCpt p)++&quot;)&quot;++</span>
<span class="lineno">  140 </span><span class="spaces">                 </span><span class="nottickedoff">indent++&quot;    (\\x-&gt;&quot;++showHS opts (indent++&quot;        &quot;) (paCl p &quot;x&quot;)++indent++&quot;    )&quot;++</span>
<span class="lineno">  141 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  142 </span><span class="spaces">        </span><span class="nottickedoff">Rmv{} -&gt; &quot;Rmv (&quot;++showHS opts &quot;&quot; (paCpt p)++&quot;)&quot;++</span>
<span class="lineno">  143 </span><span class="spaces">                 </span><span class="nottickedoff">indent++&quot;    (\\x-&gt;&quot;++showHS opts (indent++&quot;        &quot;) (paCl p &quot;x&quot;)++indent++&quot;    )&quot;++</span>
<span class="lineno">  144 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  145 </span><span class="spaces">        </span><span class="nottickedoff">Nop{} -&gt; &quot;Nop &quot;++wrap &quot;&quot; (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  146 </span><span class="spaces">        </span><span class="nottickedoff">Blk{} -&gt; &quot;Blk &quot;++wrap &quot;&quot; (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  147 </span><span class="spaces">        </span><span class="nottickedoff">Let{} -&gt; wrap &quot;Let &quot; (indent ++&quot;    &quot;) (showHS opts) (paCls p)++</span>
<span class="lineno">  148 </span><span class="spaces">                 </span><span class="nottickedoff">&quot;TODO: paBody of Let clause&quot;++</span>
<span class="lineno">  149 </span><span class="spaces">                 </span><span class="nottickedoff">wrap (if null ms then &quot;&quot; else indent ++&quot;    &quot;) (indent ++&quot;    &quot;) showMotiv ms</span>
<span class="lineno">  150 </span><span class="spaces">        </span><span class="nottickedoff">Ref{} -&gt; &quot;Ref &quot;++paVar p</span>
<span class="lineno">  151 </span><span class="spaces">     </span><span class="nottickedoff">where ms = paMotiv p</span>
<span class="lineno">  152 </span><span class="spaces">           </span><span class="nottickedoff">showMotiv ind (conj,rs) = &quot;( &quot;++showHS opts (ind++&quot;  &quot;) conj++&quot; -- conjunct:  &quot;++showADL conj++ind++&quot;, &quot;++showHSName rs++ind++&quot;)&quot;</span></span>
<span class="lineno">  153 </span>
<span class="lineno">  154 </span>instance ShowHSName SqlField where
<span class="lineno">  155 </span> <span class="decl"><span class="nottickedoff">showHSName sqFd = haskellIdentifier (&quot;sqlFld_&quot;++fldname sqFd)</span></span>
<span class="lineno">  156 </span>
<span class="lineno">  157 </span>instance ShowHS SqlField where
<span class="lineno">  158 </span> <span class="decl"><span class="nottickedoff">showHS opts indent sqFd</span>
<span class="lineno">  159 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indentA</span>
<span class="lineno">  160 </span><span class="spaces">       </span><span class="nottickedoff">[  &quot;Fld { fldname = &quot; ++ show (fldname sqFd)</span>
<span class="lineno">  161 </span><span class="spaces">       </span><span class="nottickedoff">,      &quot;, fldexpr = &quot; ++ showHS opts indentB (fldexpr sqFd)</span>
<span class="lineno">  162 </span><span class="spaces">       </span><span class="nottickedoff">,      &quot;, fldtype = &quot; ++ showHS opts &quot;&quot; (fldtype sqFd)</span>
<span class="lineno">  163 </span><span class="spaces">       </span><span class="nottickedoff">,      &quot;, flduse  = &quot; ++ showHS opts &quot;&quot; (flduse sqFd)</span>
<span class="lineno">  164 </span><span class="spaces">       </span><span class="nottickedoff">,      &quot;, fldnull = &quot; ++ show (fldnull sqFd)</span>
<span class="lineno">  165 </span><span class="spaces">       </span><span class="nottickedoff">,      &quot;, flduniq = &quot; ++ show (flduniq sqFd)</span>
<span class="lineno">  166 </span><span class="spaces">       </span><span class="nottickedoff">,      &quot;}&quot;</span>
<span class="lineno">  167 </span><span class="spaces">       </span><span class="nottickedoff">] where indentA = indent ++&quot;    &quot;         -- adding the width of &quot;Fld &quot;</span>
<span class="lineno">  168 </span><span class="spaces">               </span><span class="nottickedoff">indentB = indentA++&quot;            &quot;</span></span> -- adding the width of &quot;, fldexpr = &quot;
<span class="lineno">  169 </span>
<span class="lineno">  170 </span>instance ShowHS SqlFieldUsage where
<span class="lineno">  171 </span> <span class="decl"><span class="nottickedoff">showHS _ _ (TableKey isPrimary aCpt) = &quot;TableKey &quot;  ++show isPrimary++&quot; &quot;++showHSName aCpt</span>
<span class="lineno">  172 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ _ (ForeignKey aCpt)         = &quot;ForeignKey &quot;++showHSName aCpt</span>
<span class="lineno">  173 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ _ PlainAttr                 = &quot;PlainAttr &quot;</span></span>
<span class="lineno">  174 </span>
<span class="lineno">  175 </span>instance ShowHS SqlType where
<span class="lineno">  176 </span> <span class="decl"><span class="nottickedoff">showHS _ indent (SQLChar i)    = indent++&quot;SQLChar   &quot;++show i</span>
<span class="lineno">  177 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLBlob        = indent++&quot;SQLBlob   &quot;</span>
<span class="lineno">  178 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLPass        = indent++&quot;SQLPass   &quot;</span>
<span class="lineno">  179 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLSingle      = indent++&quot;SQLSingle &quot;</span>
<span class="lineno">  180 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLDouble      = indent++&quot;SQLDouble &quot;</span>
<span class="lineno">  181 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLText        = indent++&quot;SQLText   &quot;</span>
<span class="lineno">  182 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent (SQLuInt i)    = indent++&quot;SQLuInt   &quot;++show i</span>
<span class="lineno">  183 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent (SQLsInt i)    = indent++&quot;SQLsInt   &quot;++show i</span>
<span class="lineno">  184 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLId          = indent++&quot;SQLId     &quot;</span>
<span class="lineno">  185 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent (SQLVarchar i) = indent++&quot;SQLVarchar &quot;++show i</span>
<span class="lineno">  186 </span><span class="spaces"> </span><span class="nottickedoff">showHS _ indent SQLBool        = indent++&quot;SQLBool   &quot;</span></span>
<span class="lineno">  187 </span>
<span class="lineno">  188 </span>instance ShowHSName Quad where
<span class="lineno">  189 </span> <span class="decl"><span class="nottickedoff">showHSName q</span>
<span class="lineno">  190 </span><span class="spaces">   </span><span class="nottickedoff">= haskellIdentifier (&quot;quad_&quot;++(showHSName.qDcl) q++&quot;_&quot;++(name.qRule) q)</span></span>
<span class="lineno">  191 </span>
<span class="lineno">  192 </span>instance ShowHS Quad where
<span class="lineno">  193 </span> <span class="decl"><span class="nottickedoff">showHS _ indent q</span>
<span class="lineno">  194 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  195 </span><span class="spaces">            </span><span class="nottickedoff">[ &quot;Quad{ qDcl     = &quot; ++ showHSName (qDcl q)</span>
<span class="lineno">  196 </span><span class="spaces">            </span><span class="nottickedoff">, &quot;    , qRule    = &quot; ++ showHSName (qRule q)</span>
<span class="lineno">  197 </span><span class="spaces">            </span><span class="nottickedoff">, wrap &quot;    , qConjuncts = &quot; newindent (\_-&gt;showHSName) (qConjuncts q)</span>
<span class="lineno">  198 </span><span class="spaces">            </span><span class="nottickedoff">, &quot;    }&quot;</span>
<span class="lineno">  199 </span><span class="spaces">            </span><span class="nottickedoff">]</span>
<span class="lineno">  200 </span><span class="spaces">    </span><span class="nottickedoff">where</span>
<span class="lineno">  201 </span><span class="spaces">      </span><span class="nottickedoff">newindent = indent ++ &quot;                 &quot;</span></span>
<span class="lineno">  202 </span>
<span class="lineno">  203 </span>instance ShowHS Fswitchboard where
<span class="lineno">  204 </span> <span class="decl"><span class="nottickedoff">showHS opts indent fsb</span>
<span class="lineno">  205 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  206 </span><span class="spaces">       </span><span class="nottickedoff">[ &quot;Fswtch { fsbEvIn  = &quot; ++ showHS opts newindent (fsbEvIn  fsb)</span>
<span class="lineno">  207 </span><span class="spaces">       </span><span class="nottickedoff">, &quot;       , fsbEvOut = &quot; ++ showHS opts newindent (fsbEvOut fsb)</span>
<span class="lineno">  208 </span><span class="spaces">       </span><span class="nottickedoff">,wrap</span>
<span class="lineno">  209 </span><span class="spaces">         </span><span class="nottickedoff">&quot;       , fsbConjs = &quot; newindent' (\_-&gt;shConj) (fsbConjs  fsb)</span>
<span class="lineno">  210 </span><span class="spaces">       </span><span class="nottickedoff">,wrap</span>
<span class="lineno">  211 </span><span class="spaces">         </span><span class="nottickedoff">&quot;       , fsbECAs  = &quot; newindent' (\_-&gt;showHSName) (fsbECAs  fsb)</span>
<span class="lineno">  212 </span><span class="spaces">       </span><span class="nottickedoff">, &quot;       }&quot;</span>
<span class="lineno">  213 </span><span class="spaces">       </span><span class="nottickedoff">]</span>
<span class="lineno">  214 </span><span class="spaces">    </span><span class="nottickedoff">where</span>
<span class="lineno">  215 </span><span class="spaces">      </span><span class="nottickedoff">newindent   = indent ++ &quot;                   &quot;</span>
<span class="lineno">  216 </span><span class="spaces">      </span><span class="nottickedoff">newindent'  = newindent ++ &quot; &quot;</span>
<span class="lineno">  217 </span><span class="spaces">      </span><span class="nottickedoff">newindent'' = newindent' ++ &quot;    &quot;</span>
<span class="lineno">  218 </span><span class="spaces">      </span><span class="nottickedoff">shConj (r,conj) = &quot;( &quot;++showHSName r++newindent++&quot;   , &quot;++showHS opts newindent'' conj++newindent++&quot;   )&quot;</span></span>
<span class="lineno">  219 </span>
<span class="lineno">  220 </span>instance ShowHS DnfClause where
<span class="lineno">  221 </span> <span class="decl"><span class="nottickedoff">showHS opts indent dnf</span>
<span class="lineno">  222 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  223 </span><span class="spaces">       </span><span class="nottickedoff">[ wrap &quot;Dnf &quot; (indent++&quot;    &quot;) (\_-&gt;showHS opts (indent++&quot;      &quot;)) (antcs dnf)</span>
<span class="lineno">  224 </span><span class="spaces">       </span><span class="nottickedoff">, wrap &quot;    &quot; (indent++&quot;    &quot;) (\_-&gt;showHS opts (indent++&quot;      &quot;)) (conss dnf)</span>
<span class="lineno">  225 </span><span class="spaces">       </span><span class="nottickedoff">]</span></span>
<span class="lineno">  226 </span>
<span class="lineno">  227 </span>instance ShowHSName Conjunct where
<span class="lineno">  228 </span> <span class="decl"><span class="nottickedoff">showHSName x = haskellIdentifier (rc_id x)</span></span>
<span class="lineno">  229 </span>
<span class="lineno">  230 </span>instance ShowHS Conjunct where
<span class="lineno">  231 </span> <span class="decl"><span class="nottickedoff">showHS opts indent x</span>
<span class="lineno">  232 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate (indent ++&quot;    &quot;)</span>
<span class="lineno">  233 </span><span class="spaces">       </span><span class="nottickedoff">[   &quot;Cjct{ rc_id         = &quot; ++ show (rc_id x)</span>
<span class="lineno">  234 </span><span class="spaces">       </span><span class="nottickedoff">,       &quot;, rc_orgRules   = &quot; ++ &quot;[ &quot;++intercalate (&quot;, &quot;) (map showHSName (rc_orgRules x))++&quot;]&quot;</span>
<span class="lineno">  235 </span><span class="spaces">       </span><span class="nottickedoff">,       &quot;, rc_conjunct   = &quot; ++ showHS opts indentA (rc_conjunct x)</span>
<span class="lineno">  236 </span><span class="spaces">       </span><span class="nottickedoff">, wrap  &quot;, rc_dnfClauses = &quot; indentA (\_-&gt;showHS opts (indentA++&quot;  &quot;)) (rc_dnfClauses x)</span>
<span class="lineno">  237 </span><span class="spaces">       </span><span class="nottickedoff">,       &quot;}&quot;</span>
<span class="lineno">  238 </span><span class="spaces">       </span><span class="nottickedoff">]</span>
<span class="lineno">  239 </span><span class="spaces">     </span><span class="nottickedoff">where indentA = indent ++&quot;                    &quot;</span></span>
<span class="lineno">  240 </span>
<span class="lineno">  241 </span>instance ShowHSName FSpec where
<span class="lineno">  242 </span> <span class="decl"><span class="nottickedoff">showHSName fSpec = haskellIdentifier (&quot;fSpc_&quot;++name fSpec)</span></span>
<span class="lineno">  243 </span>
<span class="lineno">  244 </span>instance ShowHS FSpec where
<span class="lineno">  245 </span> <span class="decl"><span class="nottickedoff">showHS opts indent fSpec</span>
<span class="lineno">  246 </span><span class="spaces">  </span><span class="nottickedoff">= intercalate (indent ++&quot;    &quot;)</span>
<span class="lineno">  247 </span><span class="spaces">        </span><span class="nottickedoff">[ &quot;FSpec{ fsName        = &quot; ++ show (name fSpec)</span>
<span class="lineno">  248 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, fspos         = &quot; indentA (showHS opts) (fspos fSpec)</span>
<span class="lineno">  249 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, fsLang        = &quot; ++ show (fsLang fSpec) ++ &quot;  -- the default language for this specification&quot;</span>
<span class="lineno">  250 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, themes        = &quot; ++ show (themes fSpec) ++ &quot;  -- the names of themes to be printed in the documentation, meant for partial documentation.  Print all if empty...&quot;</span>
<span class="lineno">  251 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, pattsInScope  = &quot; indentA (\_-&gt;showHSName) (pattsInScope fSpec)</span>
<span class="lineno">  252 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, rulesInScope  = &quot; indentA (\_-&gt;showHSName) (rulesInScope fSpec)</span>
<span class="lineno">  253 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, declsInScope  = &quot; indentA (\_-&gt;showHSName) (declsInScope fSpec)</span>
<span class="lineno">  254 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, cDefsInScope  = &quot; indentA (\_-&gt;showHS opts (indentA++&quot;  &quot;)) (cDefsInScope fSpec)</span>
<span class="lineno">  255 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, gensInScope   = &quot; indentA (showHS opts)   (gensInScope fSpec)</span>
<span class="lineno">  256 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vplugInfos    = &quot; indentA (\_-&gt;showHS opts (indentA++&quot;  &quot;)) (vplugInfos fSpec)</span>
<span class="lineno">  257 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, plugInfos     = &quot; indentA (\_-&gt;showHS opts (indentA++&quot;  &quot;)) (plugInfos  fSpec)</span>
<span class="lineno">  258 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, interfaceS    = interfaceS'&quot;</span>
<span class="lineno">  259 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, interfaceG    = interfaceG'&quot;</span>
<span class="lineno">  260 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, fActivities   = &quot; indentA (\_-&gt;showHS opts (indentA++&quot;  &quot;)) (fActivities fSpec)</span>
<span class="lineno">  261 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, fRoleRels     = &quot; ++</span>
<span class="lineno">  262 </span><span class="spaces">              </span><span class="nottickedoff">case fRoleRels fSpec of</span>
<span class="lineno">  263 </span><span class="spaces">                </span><span class="nottickedoff">[]        -&gt; &quot;[]&quot;</span>
<span class="lineno">  264 </span><span class="spaces">                </span><span class="nottickedoff">[(r,rel)] -&gt; &quot;[ (&quot;++show r++&quot;, &quot;++showHS opts &quot;&quot; rel++&quot;) ]&quot;</span>
<span class="lineno">  265 </span><span class="spaces">                </span><span class="nottickedoff">_         -&gt; &quot;[ &quot;++intercalate (indentA++&quot;, &quot;) [&quot;(&quot;++show r++&quot;,&quot;++showHS opts &quot;&quot; rel++&quot;)&quot; | (r,rel)&lt;-fRoleRels fSpec]++indentA++&quot;]&quot;</span>
<span class="lineno">  266 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, fRoleRuls     = &quot; ++showHS opts indentA (fRoleRuls fSpec)</span>
<span class="lineno">  267 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, fRoles        = &quot; indentA (showHS opts)    (fRoles fSpec)</span>
<span class="lineno">  268 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vrules        = &quot; indentA (\_-&gt;showHSName) (vrules fSpec)</span>
<span class="lineno">  269 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, grules        = &quot; indentA (\_-&gt;showHSName) (grules fSpec)</span>
<span class="lineno">  270 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, invariants    = &quot; indentA (\_-&gt;showHSName) (invariants fSpec)</span>
<span class="lineno">  271 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, fallRules     = &quot; indentA (\_-&gt;showHSName) (fallRules fSpec)</span>
<span class="lineno">  272 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, allUsedDecls  = &quot; indentA (\_-&gt;showHSName) (allUsedDecls fSpec)</span>
<span class="lineno">  273 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, allDecls      = &quot; indentA (\_-&gt;showHSName) (allDecls fSpec)</span>
<span class="lineno">  274 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vrels         = &quot; indentA (\_-&gt;showHSName) (vrels fSpec)</span>
<span class="lineno">  275 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, allConcepts   = &quot; indentA (\_-&gt;showHSName) (allConcepts fSpec)</span>
<span class="lineno">  276 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, kernels       = &quot; indentA (\_-&gt;showHSName) (kernels fSpec)</span>
<span class="lineno">  277 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vIndices      = &quot; indentA (\_-&gt;showHSName) (vIndices fSpec)</span>
<span class="lineno">  278 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vviews        = &quot; indentA (\_-&gt;showHSName) (vviews fSpec)</span>
<span class="lineno">  279 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vgens         = &quot; indentA (showHS opts)    (vgens fSpec)</span>
<span class="lineno">  280 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, fsisa         = &quot; indentA (\_-&gt;showHSName) (fsisa fSpec)</span>
<span class="lineno">  281 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vconjs        = &quot; indentA (\_-&gt;showHSName) (vconjs fSpec)</span>
<span class="lineno">  282 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vquads        = &quot; indentA (\_-&gt;showHSName) (vquads fSpec)</span>
<span class="lineno">  283 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vEcas         = &quot; indentA (\_-&gt;showHSName) (vEcas fSpec)</span>
<span class="lineno">  284 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, fSwitchboard  = &quot;++showHS opts indentA (fSwitchboard fSpec)</span>
<span class="lineno">  285 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, vpatterns     = &quot; indentA (\_-&gt;showHSName) (vpatterns fSpec)</span>
<span class="lineno">  286 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, conceptDefs   = &quot; indentA (showHS opts)    (conceptDefs fSpec)</span>
<span class="lineno">  287 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, fSexpls       = &quot; indentA (showHS opts)    (fSexpls fSpec)</span>
<span class="lineno">  288 </span><span class="spaces">        </span><span class="nottickedoff">,     &quot;, metas         = allMetas&quot;</span>
<span class="lineno">  289 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, initialPops   = &quot; indentA (showHS opts)   (initialPops fSpec)</span>
<span class="lineno">  290 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, allViolations = &quot; indentA showViolatedRule (allViolations fSpec)</span>
<span class="lineno">  291 </span><span class="spaces">        </span><span class="nottickedoff">,wrap &quot;, allExprs      = &quot; indentA (showHS opts)    (allExprs fSpec)</span>
<span class="lineno">  292 </span><span class="spaces">        </span><span class="nottickedoff">,&quot;}&quot;</span>
<span class="lineno">  293 </span><span class="spaces">        </span><span class="nottickedoff">] ++</span>
<span class="lineno">  294 </span><span class="spaces">    </span><span class="nottickedoff">indent++&quot;where&quot;++</span>
<span class="lineno">  295 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- ***Interfaces Specified in Ampersand script***: &quot;++</span>
<span class="lineno">  296 </span><span class="spaces">    </span><span class="nottickedoff">indent++&quot; interfaceS' = &quot;++(if null (interfaceS fSpec) then &quot;[]&quot; else</span>
<span class="lineno">  297 </span><span class="spaces">                              </span><span class="nottickedoff">&quot;[ &quot;++intercalate (indentB++&quot;  , &quot;) (map showHSName (interfaceS fSpec))++indentB++&quot;  ]&quot;)++</span>
<span class="lineno">  298 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- ***Activities Generated by the Ampersand compiler ***: &quot; ++</span>
<span class="lineno">  299 </span><span class="spaces">    </span><span class="nottickedoff">indent++&quot; interfaceG' = &quot;++(if null (interfaceG fSpec) then &quot;[]&quot; else</span>
<span class="lineno">  300 </span><span class="spaces">                              </span><span class="nottickedoff">&quot;[ &quot;++intercalate (indentB++&quot;, &quot;) (map showHSName (interfaceG fSpec))++indentB++&quot;]&quot;)++</span>
<span class="lineno">  301 </span><span class="spaces">    </span><span class="nottickedoff">indent++&quot; allMetas = &quot;++(if null (metas fSpec) then &quot;[]&quot; else</span>
<span class="lineno">  302 </span><span class="spaces">                              </span><span class="nottickedoff">&quot;[ &quot;++intercalate (indentB++&quot;, &quot;) (map (showHS opts (indent ++ &quot;         &quot;)) (metas fSpec))++indentB++&quot;]&quot;) ++</span>
<span class="lineno">  303 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  304 </span><span class="spaces"></span><span class="nottickedoff">-- WHY?  staan hier verschillende lijstjes met interfaces?</span>
<span class="lineno">  305 </span><span class="spaces"></span><span class="nottickedoff">-- BECAUSE! Een Ampersand engineer besteedt veel tijd om vanuit een kennismodel (lees: een graaf met concepten en relaties)</span>
<span class="lineno">  306 </span><span class="spaces"></span><span class="nottickedoff">--          alle interfaces met de hand te verzinnen.</span>
<span class="lineno">  307 </span><span class="spaces"></span><span class="nottickedoff">--          Je kunt natuurlijk ook een interfaces-generator aan het werk zetten, die een aantal interfaces klaarzet bij wijze</span>
<span class="lineno">  308 </span><span class="spaces"></span><span class="nottickedoff">--          van steiger (scaffold). Dat bespaart een hoop werk. De functie interfaceG is zo'n generator.</span>
<span class="lineno">  309 </span><span class="spaces"></span><span class="nottickedoff">--          Door de gegenereerde interfaces af te drukken, kun je dus heel snel Ampersand sourcecode maken met correct-vertaalbare interfaces.</span>
<span class="lineno">  310 </span><span class="spaces"></span><span class="nottickedoff">--          Heb je eenmaal een goed werkend pakket interfaces, dan wil je wellicht alleen de door jezelf gespecificeerde interfaces</span>
<span class="lineno">  311 </span><span class="spaces"></span><span class="nottickedoff">--          gebruiken. Dat gebeurt in interfaceS.</span>
<span class="lineno">  312 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  313 </span><span class="spaces">    </span><span class="nottickedoff">(if null  (interfaceS fSpec) then &quot;&quot;  else</span>
<span class="lineno">  314 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** User defined interfaces (total: &quot;++(show.length.interfaceS) fSpec++&quot; interfaces) ***: &quot;++</span>
<span class="lineno">  315 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName s++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) s | s&lt;-interfaceS fSpec]++&quot;\n&quot;</span>
<span class="lineno">  316 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  317 </span><span class="spaces">    </span><span class="nottickedoff">(if null (interfaceG fSpec ) then &quot;&quot; else</span>
<span class="lineno">  318 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Generated interfaces (total: &quot;++(show.length.interfaceG) fSpec++&quot; interfaces) ***: &quot;++</span>
<span class="lineno">  319 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-interfaceG fSpec ]++&quot;\n&quot;</span>
<span class="lineno">  320 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  321 </span><span class="spaces">    </span><span class="nottickedoff">(let ds fs = allDecls fs `uni` allUsedDecls fs `uni` vrels fSpec `uni` (nub . map qDcl . vquads) fs in</span>
<span class="lineno">  322 </span><span class="spaces">     </span><span class="nottickedoff">if null (ds fSpec)     then &quot;&quot; else</span>
<span class="lineno">  323 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Declared relations (in total: &quot;++(show.length.ds) fSpec++&quot; relations) ***: &quot;++</span>
<span class="lineno">  324 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-ds fSpec]++&quot;\n&quot;</span>
<span class="lineno">  325 </span><span class="spaces">    </span><span class="nottickedoff">) ++</span>
<span class="lineno">  326 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vIndices fSpec)     then &quot;&quot; else</span>
<span class="lineno">  327 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Indices (total: &quot;++(show.length.vIndices) fSpec++&quot; indices) ***: &quot;++</span>
<span class="lineno">  328 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-vIndices fSpec]++&quot;\n&quot;</span>
<span class="lineno">  329 </span><span class="spaces">    </span><span class="nottickedoff">) ++</span>
<span class="lineno">  330 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vviews fSpec)     then &quot;&quot; else</span>
<span class="lineno">  331 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Views (total: &quot;++(show.length.vviews) fSpec++&quot; views) ***: &quot;++</span>
<span class="lineno">  332 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-vviews fSpec]++&quot;\n&quot;</span>
<span class="lineno">  333 </span><span class="spaces">    </span><span class="nottickedoff">) ++</span>
<span class="lineno">  334 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vrules   fSpec ) then &quot;&quot; else</span>
<span class="lineno">  335 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** User defined rules (total: &quot;++(show.length.vrules) fSpec++&quot; rules) ***: &quot;++</span>
<span class="lineno">  336 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-vrules     fSpec ]++&quot;\n&quot;</span>
<span class="lineno">  337 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  338 </span><span class="spaces">    </span><span class="nottickedoff">(if null (grules   fSpec ) then &quot;&quot; else</span>
<span class="lineno">  339 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Generated rules (total: &quot;++(show.length.grules) fSpec++&quot; rules) ***: &quot;++</span>
<span class="lineno">  340 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-grules     fSpec ]++&quot;\n&quot;</span>
<span class="lineno">  341 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  342 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vconjs fSpec ) then &quot;&quot; else</span>
<span class="lineno">  343 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Conjuncts (total: &quot;++(show.length.vconjs) fSpec++&quot; conjuncts) ***: &quot;++</span>
<span class="lineno">  344 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-vconjs     fSpec ]++&quot;\n&quot;</span>
<span class="lineno">  345 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  346 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vquads fSpec ) then &quot;&quot; else</span>
<span class="lineno">  347 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Quads (total: &quot;++(show.length.vquads) fSpec++&quot; quads) ***: &quot;++</span>
<span class="lineno">  348 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-vquads     fSpec ]++&quot;\n&quot;</span>
<span class="lineno">  349 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  350 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vEcas fSpec ) then &quot;&quot; else</span>
<span class="lineno">  351 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** ECA rules (total: &quot;++(show.length.vEcas) fSpec++&quot; ECA rules) ***: &quot;++</span>
<span class="lineno">  352 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName eca++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) eca |eca&lt;-vEcas fSpec ]++&quot;\n&quot;++</span>
<span class="lineno">  353 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName rel++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) rel |rel&lt;-nub(map ecaDelta (vEcas fSpec)) ]++&quot;\n&quot;</span>
<span class="lineno">  354 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  355 </span><span class="spaces">    </span><span class="nottickedoff">(if null (plugInfos fSpec ) then &quot;&quot; else</span>
<span class="lineno">  356 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** PlugInfos (total: &quot;++(show.length.plugInfos) fSpec++&quot; plugInfos) ***: &quot;++</span>
<span class="lineno">  357 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName p++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) p |InternalPlug p&lt;-sortBy (compare `on` name) (plugInfos fSpec) ]++&quot;\n&quot;</span>
<span class="lineno">  358 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  359 </span><span class="spaces">    </span><span class="nottickedoff">(if null (vpatterns fSpec) then &quot;&quot; else</span>
<span class="lineno">  360 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Patterns (total: &quot;++(show.length.vpatterns) fSpec++&quot; patterns) ***: &quot;++</span>
<span class="lineno">  361 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x |x&lt;-vpatterns fSpec]++&quot;\n&quot;</span>
<span class="lineno">  362 </span><span class="spaces">    </span><span class="nottickedoff">)++</span>
<span class="lineno">  363 </span><span class="spaces"></span><span class="nottickedoff">--       (if null (conceptDefs fSpec) then &quot;&quot; else</span>
<span class="lineno">  364 </span><span class="spaces"></span><span class="nottickedoff">--        &quot;\n -- *** ConceptDefs (total: &quot;++(show.length.conceptDefs) fSpec++&quot; conceptDefs) ***: &quot;++</span>
<span class="lineno">  365 </span><span class="spaces"></span><span class="nottickedoff">--        concat [indent++&quot; &quot;++showHSName cd++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) cd | c&lt;-concs fSpec, cd&lt;-concDefs fSpec c]++&quot;\n&quot;</span>
<span class="lineno">  366 </span><span class="spaces"></span><span class="nottickedoff">--       )++</span>
<span class="lineno">  367 </span><span class="spaces">    </span><span class="nottickedoff">(if null (allConcepts fSpec) then &quot;&quot; else</span>
<span class="lineno">  368 </span><span class="spaces">     </span><span class="nottickedoff">&quot;\n -- *** Concepts (total: &quot;++(show.length.allConcepts) fSpec++&quot; concepts) ***: &quot;++</span>
<span class="lineno">  369 </span><span class="spaces">     </span><span class="nottickedoff">concat [indent++&quot; &quot;++showHSName x++indent++&quot;  = &quot;++showHS opts (indent++&quot;    &quot;) x</span>
<span class="lineno">  370 </span><span class="spaces">          </span><span class="nottickedoff">++ indent++&quot;    &quot;++showAtomsOfConcept x |x&lt;-sortBy (comparing showHSName) (allConcepts fSpec)]++&quot;\n&quot;</span>
<span class="lineno">  371 </span><span class="spaces">    </span><span class="nottickedoff">)</span>
<span class="lineno">  372 </span><span class="spaces">        </span><span class="nottickedoff">where indentA = indent ++&quot;                      &quot;</span>
<span class="lineno">  373 </span><span class="spaces">              </span><span class="nottickedoff">indentB = indent ++&quot;             &quot;</span>
<span class="lineno">  374 </span><span class="spaces">              </span><span class="nottickedoff">showAtomsOfConcept c =</span>
<span class="lineno">  375 </span><span class="spaces">                           </span><span class="nottickedoff">&quot;-- atoms: [ &quot;++ intercalate indentC strs++&quot;]&quot;</span>
<span class="lineno">  376 </span><span class="spaces">                  </span><span class="nottickedoff">where</span>
<span class="lineno">  377 </span><span class="spaces">                    </span><span class="nottickedoff">strs = map show (sort (atomsOf (vgens fSpec)(initialPops fSpec) c))</span>
<span class="lineno">  378 </span><span class="spaces">                    </span><span class="nottickedoff">indentC = if sum (map length strs) &gt; 300</span>
<span class="lineno">  379 </span><span class="spaces">                              </span><span class="nottickedoff">then indent ++ &quot;    --        , &quot;</span>
<span class="lineno">  380 </span><span class="spaces">                              </span><span class="nottickedoff">else &quot;, &quot;</span>
<span class="lineno">  381 </span><span class="spaces">              </span><span class="nottickedoff">showViolatedRule :: String -&gt; (Rule,Pairs) -&gt; String</span>
<span class="lineno">  382 </span><span class="spaces">              </span><span class="nottickedoff">showViolatedRule indent' (r,ps)</span>
<span class="lineno">  383 </span><span class="spaces">                 </span><span class="nottickedoff">= intercalate indent'</span>
<span class="lineno">  384 </span><span class="spaces">                     </span><span class="nottickedoff">[        &quot; ( &quot;++showHSName r++&quot; -- This is &quot;++(if isSignal r then &quot;a process rule.&quot; else &quot;an invariant&quot;)++</span>
<span class="lineno">  385 </span><span class="spaces">                      </span><span class="nottickedoff">indent'++&quot; , &quot;++ wrap &quot;&quot; (indent'++&quot;   &quot;) (let showPair _ p = show p --&quot;( &quot;++ (show.fst) p++&quot;, &quot;++(show.snd) p++&quot;)&quot;</span>
<span class="lineno">  386 </span><span class="spaces">                                                                   </span><span class="nottickedoff">in showPair) ps++</span>
<span class="lineno">  387 </span><span class="spaces">                      </span><span class="nottickedoff">indent'++&quot; )&quot;</span>
<span class="lineno">  388 </span><span class="spaces">                     </span><span class="nottickedoff">]</span></span>
<span class="lineno">  389 </span>
<span class="lineno">  390 </span>instance ShowHS Meta where
<span class="lineno">  391 </span> <span class="decl"><span class="nottickedoff">showHS f i (Meta pos obj nm val) = &quot;Meta (&quot;++showHS f i pos ++ &quot;) &quot;++ show obj ++ &quot; &quot; ++ show nm ++ &quot; &quot; ++ show val</span></span>
<span class="lineno">  392 </span>
<span class="lineno">  393 </span>
<span class="lineno">  394 </span>instance ShowHSName PlugInfo where
<span class="lineno">  395 </span> <span class="decl"><span class="nottickedoff">showHSName (InternalPlug p) = haskellIdentifier (&quot;ipl_&quot;++name p)-- TODO</span>
<span class="lineno">  396 </span><span class="spaces"> </span><span class="nottickedoff">showHSName (ExternalPlug _) = fatal 336 &quot;a PlugInfo is anonymous with respect to showHS opts&quot;</span></span>
<span class="lineno">  397 </span>
<span class="lineno">  398 </span>instance ShowHS PlugInfo where
<span class="lineno">  399 </span> <span class="decl"><span class="nottickedoff">showHS _ _ (InternalPlug p)</span>
<span class="lineno">  400 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;InternalPlug &quot;++showHSName p</span>
<span class="lineno">  401 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts ind (ExternalPlug o)</span>
<span class="lineno">  402 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;ExternalPlug &quot;++showHS opts (ind++&quot;    &quot;) o</span></span>
<span class="lineno">  403 </span>
<span class="lineno">  404 </span>instance ShowHS A_RoleRelation where
<span class="lineno">  405 </span> <span class="decl"><span class="nottickedoff">showHS opts ind rr</span>
<span class="lineno">  406 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;RR &quot;++show (rrRoles rr)++&quot; &quot;++showHS opts (ind++&quot;    &quot;) (rrRels rr)++&quot; &quot;++showHS opts (ind++&quot;    &quot;) (rrPos rr)</span></span>
<span class="lineno">  407 </span>instance ShowHS Role where
<span class="lineno">  408 </span> <span class="decl"><span class="nottickedoff">showHS _ ind (Role str) = ind++&quot;Role &quot;++show str</span></span>
<span class="lineno">  409 </span>instance ShowHS P_RoleRule where
<span class="lineno">  410 </span> <span class="decl"><span class="nottickedoff">showHS opts ind rs</span>
<span class="lineno">  411 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;Maintain &quot;++show (mRoles rs)++&quot; &quot;++show (mRules rs)++&quot; &quot;++showHS opts (ind++&quot;    &quot;) (mPos rs)</span></span>
<span class="lineno">  412 </span>instance ShowHS (Role,Rule) where
<span class="lineno">  413 </span> <span class="decl"><span class="nottickedoff">showHS _ _ (rol,rul)</span>
<span class="lineno">  414 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;(&quot;++show rol++&quot;, &quot;++showHSName rul++&quot;)&quot;</span></span>
<span class="lineno">  415 </span>instance ShowHSName FSid where
<span class="lineno">  416 </span> <span class="decl"><span class="nottickedoff">showHSName (FS_id nm ) = haskellIdentifier nm</span></span>
<span class="lineno">  417 </span>
<span class="lineno">  418 </span>instance ShowHS FSid where
<span class="lineno">  419 </span> <span class="decl"><span class="nottickedoff">showHS _ _ (FS_id nm)</span>
<span class="lineno">  420 </span><span class="spaces">   </span><span class="nottickedoff">= &quot;(FS_id &quot; ++ show nm ++ &quot;)&quot;</span></span>
<span class="lineno">  421 </span>
<span class="lineno">  422 </span>instance ShowHSName Pattern where
<span class="lineno">  423 </span> <span class="decl"><span class="nottickedoff">showHSName pat = haskellIdentifier (&quot;pat_&quot;++name pat)</span></span>
<span class="lineno">  424 </span>
<span class="lineno">  425 </span>instance ShowHS Pattern where
<span class="lineno">  426 </span> <span class="decl"><span class="nottickedoff">showHS opts indent pat</span>
<span class="lineno">  427 </span><span class="spaces">  </span><span class="nottickedoff">= intercalate indentA</span>
<span class="lineno">  428 </span><span class="spaces">     </span><span class="nottickedoff">[ &quot;A_Pat { ptnm  = &quot;++show (name pat)</span>
<span class="lineno">  429 </span><span class="spaces">     </span><span class="nottickedoff">, &quot;, ptpos = &quot;++showHS opts &quot;&quot; (ptpos pat)</span>
<span class="lineno">  430 </span><span class="spaces">     </span><span class="nottickedoff">, &quot;, ptend = &quot;++showHS opts &quot;&quot; (ptend pat)</span>
<span class="lineno">  431 </span><span class="spaces">     </span><span class="nottickedoff">, &quot;, ptrls = [&quot; ++intercalate &quot;, &quot; [showHSName r | r&lt;-ptrls pat] ++ concat [&quot; {- no rules -} &quot;        | null (ptrls pat)] ++&quot;]&quot;</span>
<span class="lineno">  432 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, ptgns = &quot; indentB (showHS opts) (ptgns pat)</span>
<span class="lineno">  433 </span><span class="spaces">     </span><span class="nottickedoff">, &quot;, ptdcs = [ &quot; ++intercalate (indentB++&quot;, &quot;) [showHSName d | d&lt;-ptdcs pat] ++ concat [&quot; {- no relations -} &quot; | null (ptdcs pat)] ++indentB++&quot;]&quot;</span>
<span class="lineno">  434 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, ptups = &quot; indentB (showHS opts) (ptups pat)</span>
<span class="lineno">  435 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, ptids = &quot; indentB (showHS opts) (ptids pat)</span>
<span class="lineno">  436 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, ptvds = &quot; indentB (showHS opts) (ptvds pat)</span>
<span class="lineno">  437 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, ptxps = &quot; indentB (showHS opts) (ptxps pat)</span>
<span class="lineno">  438 </span><span class="spaces">     </span><span class="nottickedoff">, &quot;}&quot;</span>
<span class="lineno">  439 </span><span class="spaces">     </span><span class="nottickedoff">] where indentA = indent ++&quot;      &quot;     -- adding the width of &quot;A_Pat &quot;</span>
<span class="lineno">  440 </span><span class="spaces">             </span><span class="nottickedoff">indentB = indentA++&quot;          &quot;</span></span> -- adding the width of &quot;, ptrls = &quot;
<span class="lineno">  441 </span>
<span class="lineno">  442 </span>instance ShowHS Activity where
<span class="lineno">  443 </span> <span class="decl"><span class="nottickedoff">showHS opts indent act =</span>
<span class="lineno">  444 </span><span class="spaces">    </span><span class="nottickedoff">intercalate indentA</span>
<span class="lineno">  445 </span><span class="spaces">     </span><span class="nottickedoff">[ &quot;Act { actRule   = &quot;++showHSName (actRule act)</span>
<span class="lineno">  446 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, actTrig   = &quot; indentB (\_-&gt;showHSName) (actTrig   act)</span>
<span class="lineno">  447 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, actAffect = &quot; indentB (\_-&gt;showHSName) (actAffect act)</span>
<span class="lineno">  448 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, actQuads  = &quot; indentB (\_-&gt;showHSName) (actQuads  act)</span>
<span class="lineno">  449 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, actEcas   = &quot; indentB (\_-&gt;showHSName) (actEcas   act)</span>
<span class="lineno">  450 </span><span class="spaces">     </span><span class="nottickedoff">, wrap &quot;, actPurp   = &quot; indentB (\_-&gt;(showHS opts indentB)) (actPurp act)</span>
<span class="lineno">  451 </span><span class="spaces">     </span><span class="nottickedoff">, &quot;      }&quot;</span>
<span class="lineno">  452 </span><span class="spaces">     </span><span class="nottickedoff">]</span>
<span class="lineno">  453 </span><span class="spaces">    </span><span class="nottickedoff">where indentA = indent ++replicate (length (&quot;Act &quot;::String)) ' '</span>
<span class="lineno">  454 </span><span class="spaces">          </span><span class="nottickedoff">indentB = indentA++replicate (length (&quot;, actAffect = &quot; :: String)) ' '</span></span>
<span class="lineno">  455 </span>
<span class="lineno">  456 </span>instance ShowHS PPurpose where
<span class="lineno">  457 </span> <span class="decl"><span class="nottickedoff">showHS opts _ expl =</span>
<span class="lineno">  458 </span><span class="spaces">    </span><span class="nottickedoff">&quot;PRef2 (&quot;++showHS opts &quot;&quot; (pexPos     expl)++&quot;) &quot;++</span>
<span class="lineno">  459 </span><span class="spaces">          </span><span class="nottickedoff">&quot;(&quot;++showHS opts &quot;&quot; (pexObj     expl)++&quot;) &quot;++</span>
<span class="lineno">  460 </span><span class="spaces">          </span><span class="nottickedoff">&quot;(&quot;++showHS opts &quot;&quot; (pexMarkup  expl)++&quot;) &quot;</span>
<span class="lineno">  461 </span><span class="spaces">             </span><span class="nottickedoff">++show (intercalate &quot;;&quot; (pexRefIDs expl))++&quot; &quot;</span></span>
<span class="lineno">  462 </span>
<span class="lineno">  463 </span>instance ShowHS PRef2Obj where
<span class="lineno">  464 </span> <span class="decl"><span class="nottickedoff">showHS _ _ peObj</span>
<span class="lineno">  465 </span><span class="spaces">  </span><span class="nottickedoff">= case peObj of</span>
<span class="lineno">  466 </span><span class="spaces">         </span><span class="nottickedoff">PRef2ConceptDef str                    -&gt; &quot;PRef2ConceptDef &quot; ++show str</span>
<span class="lineno">  467 </span><span class="spaces">         </span><span class="nottickedoff">PRef2Declaration (PNamedRel _ nm mSgn) -&gt; &quot;PRef2Declaration &quot;++show nm++maybe &quot;&quot; show mSgn</span>
<span class="lineno">  468 </span><span class="spaces">         </span><span class="nottickedoff">PRef2Rule str                          -&gt; &quot;PRef2Rule &quot;       ++show str</span>
<span class="lineno">  469 </span><span class="spaces">         </span><span class="nottickedoff">PRef2IdentityDef str                   -&gt; &quot;PRef2IdentityDef &quot;++show str</span>
<span class="lineno">  470 </span><span class="spaces">         </span><span class="nottickedoff">PRef2ViewDef str                       -&gt; &quot;PRef2ViewDef &quot;    ++show str</span>
<span class="lineno">  471 </span><span class="spaces">         </span><span class="nottickedoff">PRef2Pattern str                       -&gt; &quot;PRef2Pattern &quot;    ++show str</span>
<span class="lineno">  472 </span><span class="spaces">         </span><span class="nottickedoff">PRef2Interface str                     -&gt; &quot;PRef2Interface &quot;  ++show str</span>
<span class="lineno">  473 </span><span class="spaces">         </span><span class="nottickedoff">PRef2Context str                       -&gt; &quot;PRef2Context &quot;    ++show str</span>
<span class="lineno">  474 </span><span class="spaces">         </span><span class="nottickedoff">PRef2Fspc str                          -&gt; &quot;PRef2Fspc &quot;       ++show str</span></span>
<span class="lineno">  475 </span>
<span class="lineno">  476 </span>instance ShowHS Purpose where
<span class="lineno">  477 </span> <span class="decl"><span class="nottickedoff">showHS opts _ expla =</span>
<span class="lineno">  478 </span><span class="spaces">    </span><span class="nottickedoff">&quot;Expl &quot;++&quot;(&quot;++showHS opts &quot;&quot; (explPos expla)++&quot;) &quot;</span>
<span class="lineno">  479 </span><span class="spaces">           </span><span class="nottickedoff">++&quot;(&quot;++showHS opts &quot;&quot; (explObj expla)++&quot;) &quot;</span>
<span class="lineno">  480 </span><span class="spaces">                </span><span class="nottickedoff">++showHS opts &quot;&quot; (explMarkup  expla)++&quot; &quot;</span>
<span class="lineno">  481 </span><span class="spaces">                </span><span class="nottickedoff">++show (explUserdefd expla)++&quot; &quot;</span>
<span class="lineno">  482 </span><span class="spaces">                </span><span class="nottickedoff">++show (explRefIds expla)++&quot; &quot;</span></span>
<span class="lineno">  483 </span>
<span class="lineno">  484 </span>instance ShowHS ExplObj where
<span class="lineno">  485 </span> <span class="decl"><span class="nottickedoff">showHS opts i peObj = case peObj of</span>
<span class="lineno">  486 </span><span class="spaces">          </span><span class="nottickedoff">ExplConceptDef cd  -&gt; &quot;ExplConceptDef &quot; ++showHS opts i cd</span>
<span class="lineno">  487 </span><span class="spaces">          </span><span class="nottickedoff">ExplDeclaration d  -&gt; &quot;ExplDeclaration &quot;++showHSName d</span>
<span class="lineno">  488 </span><span class="spaces">          </span><span class="nottickedoff">ExplRule str       -&gt; &quot;ExplRule &quot;       ++show str</span>
<span class="lineno">  489 </span><span class="spaces">          </span><span class="nottickedoff">ExplIdentityDef str-&gt; &quot;ExplIdentityDef &quot;++show str</span>
<span class="lineno">  490 </span><span class="spaces">          </span><span class="nottickedoff">ExplViewDef str    -&gt; &quot;ExplViewDef &quot;    ++show str</span>
<span class="lineno">  491 </span><span class="spaces">          </span><span class="nottickedoff">ExplPattern str    -&gt; &quot;ExplPattern &quot;    ++show str</span>
<span class="lineno">  492 </span><span class="spaces">          </span><span class="nottickedoff">ExplInterface str  -&gt; &quot;ExplInterface &quot;  ++show str</span>
<span class="lineno">  493 </span><span class="spaces">          </span><span class="nottickedoff">ExplContext str    -&gt; &quot;ExplContext &quot;    ++show str</span></span>
<span class="lineno">  494 </span>
<span class="lineno">  495 </span>instance ShowHS P_Markup where
<span class="lineno">  496 </span> <span class="decl"><span class="nottickedoff">showHS _ indent m</span>
<span class="lineno">  497 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  498 </span><span class="spaces">     </span><span class="nottickedoff">[&quot;P_Markup{ mLang   = &quot;++ show (mLang m)</span>
<span class="lineno">  499 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;        , mFormat = &quot;++ show (mFormat m)</span>
<span class="lineno">  500 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;        , mString = &quot;++ show (mString m)</span>
<span class="lineno">  501 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;        }&quot;</span>
<span class="lineno">  502 </span><span class="spaces">     </span><span class="nottickedoff">]</span></span>
<span class="lineno">  503 </span>
<span class="lineno">  504 </span>instance ShowHS A_Markup where
<span class="lineno">  505 </span> <span class="decl"><span class="nottickedoff">showHS _ indent m</span>
<span class="lineno">  506 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  507 </span><span class="spaces">     </span><span class="nottickedoff">[&quot;A_Markup{ amLang   = &quot;++ show (amLang m)</span>
<span class="lineno">  508 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;        , amFormat = &quot;++ show (amFormat m)</span>
<span class="lineno">  509 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;        , amPandoc = &quot;++ show (amPandoc m)</span>
<span class="lineno">  510 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;        }&quot;</span>
<span class="lineno">  511 </span><span class="spaces">     </span><span class="nottickedoff">]</span></span>
<span class="lineno">  512 </span>
<span class="lineno">  513 </span>instance ShowHS (PairView Expression) where
<span class="lineno">  514 </span>  <span class="decl"><span class="nottickedoff">showHS opts indent (PairView pvs) = &quot;PairView &quot;++showHS opts indent pvs</span></span>
<span class="lineno">  515 </span>
<span class="lineno">  516 </span>instance ShowHS (PairViewSegment Expression) where
<span class="lineno">  517 </span>  <span class="decl"><span class="nottickedoff">showHS _     _ (PairViewText _ txt) = &quot;PairViewText &quot;++show txt</span>
<span class="lineno">  518 </span><span class="spaces">  </span><span class="nottickedoff">showHS opts _ (PairViewExp _ srcOrTgt e) = &quot;PairViewExp &quot;++show srcOrTgt++&quot; (&quot;++showHS opts &quot;&quot; e++&quot;)&quot;</span></span>
<span class="lineno">  519 </span>
<span class="lineno">  520 </span>instance ShowHSName Rule where
<span class="lineno">  521 </span> <span class="decl"><span class="nottickedoff">showHSName r = haskellIdentifier (&quot;rule_&quot;++ rrnm r)</span></span>
<span class="lineno">  522 </span>
<span class="lineno">  523 </span>instance ShowHS Rule where
<span class="lineno">  524 </span> <span class="decl"><span class="nottickedoff">showHS opts indent r@(Ru _ _ _ _ _ _ _ _ _ _ _)  -- This pattern matching occurs so Haskell will detect any change in the definition of Ru.</span>
<span class="lineno">  525 </span><span class="spaces">   </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  526 </span><span class="spaces">     </span><span class="nottickedoff">[&quot;Ru{ rrnm   = &quot; ++ show (rrnm   r)</span>
<span class="lineno">  527 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrexp  = -- &quot; ++ showADL (rrexp  r) ++ indent++&quot;             &quot; ++ showHS opts (indent++&quot;             &quot;) (rrexp  r)</span>
<span class="lineno">  528 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrfps  = &quot; ++ showHS opts &quot;&quot; (rrfps  r)</span>
<span class="lineno">  529 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrmean = &quot; ++ showHS opts (indent++&quot;             &quot;) (rrmean r)</span>
<span class="lineno">  530 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrmsg  = &quot; ++ showHS opts &quot;&quot; (rrmsg  r)</span>
<span class="lineno">  531 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrviol = &quot; ++ showHS opts &quot;&quot; (rrviol r)</span>
<span class="lineno">  532 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrtyp  = &quot; ++ showHS opts &quot;&quot; (rrtyp  r)</span>
<span class="lineno">  533 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , rrdcl  = &quot; ++ case rrdcl r of</span>
<span class="lineno">  534 </span><span class="spaces">                           </span><span class="nottickedoff">Just (p,d) -&gt; &quot;Just (&quot;++showHSName p++&quot;, &quot;++showHSName d++&quot; )&quot;</span>
<span class="lineno">  535 </span><span class="spaces">                           </span><span class="nottickedoff">Nothing    -&gt; &quot;Nothing&quot;</span>
<span class="lineno">  536 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , r_env  = &quot; ++ show (r_env  r)</span>
<span class="lineno">  537 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , r_usr  = &quot; ++ show (r_usr  r)</span>
<span class="lineno">  538 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  , isSignal = &quot; ++ show (isSignal  r)</span>
<span class="lineno">  539 </span><span class="spaces">     </span><span class="nottickedoff">,&quot;  }&quot;</span>
<span class="lineno">  540 </span><span class="spaces">     </span><span class="nottickedoff">]</span></span>
<span class="lineno">  541 </span>
<span class="lineno">  542 </span>instance ShowHS AMeaning where
<span class="lineno">  543 </span>  <span class="decl"><span class="nottickedoff">showHS opts indent (AMeaning x) = &quot;AMeaning &quot; ++ showHS opts (indent++&quot;        &quot;) x</span></span>
<span class="lineno">  544 </span>
<span class="lineno">  545 </span>instance ShowHS RuleType where
<span class="lineno">  546 </span>  <span class="decl"><span class="nottickedoff">showHS _ _ Truth          = &quot;Truth&quot;</span>
<span class="lineno">  547 </span><span class="spaces">  </span><span class="nottickedoff">showHS _ _ Equivalence    = &quot;Equivalence&quot;</span>
<span class="lineno">  548 </span><span class="spaces">  </span><span class="nottickedoff">showHS _ _ Implication    = &quot;Implication&quot;</span></span>
<span class="lineno">  549 </span>
<span class="lineno">  550 </span>instance ShowHSName IdentityDef where
<span class="lineno">  551 </span> <span class="decl"><span class="nottickedoff">showHSName identity = haskellIdentifier (&quot;identity_&quot;++name identity)</span></span>
<span class="lineno">  552 </span>
<span class="lineno">  553 </span>instance ShowHS IdentityDef where
<span class="lineno">  554 </span> <span class="decl"><span class="nottickedoff">showHS opts indent identity</span>
<span class="lineno">  555 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;Id (&quot;++showHS opts &quot;&quot; (idPos identity)++&quot;) &quot;++show (idLbl identity)++&quot; (&quot;++showHSName (idCpt identity)++&quot;)&quot;</span>
<span class="lineno">  556 </span><span class="spaces">    </span><span class="nottickedoff">++indent++&quot;  [ &quot;++intercalate (indent++&quot;  , &quot;) (map (showHS opts indent) $ identityAts identity)++indent++&quot;  ]&quot;</span></span>
<span class="lineno">  557 </span>
<span class="lineno">  558 </span>instance ShowHS IdentitySegment where
<span class="lineno">  559 </span> <span class="decl"><span class="nottickedoff">showHS opts indent (IdentityExp objDef) = &quot;IdentityExp (&quot;++ showHS opts indent objDef ++ &quot;)&quot;</span></span>
<span class="lineno">  560 </span>
<span class="lineno">  561 </span>instance ShowHSName ViewDef where
<span class="lineno">  562 </span> <span class="decl"><span class="nottickedoff">showHSName vd = haskellIdentifier (&quot;vdef_&quot;++name vd)</span></span>
<span class="lineno">  563 </span>
<span class="lineno">  564 </span>instance ShowHS ViewDef where
<span class="lineno">  565 </span> <span class="decl"><span class="nottickedoff">showHS opts indent vd</span>
<span class="lineno">  566 </span><span class="spaces">  </span><span class="nottickedoff">= &quot;Vd (&quot;++showHS opts &quot;&quot; (vdpos vd)++&quot;) &quot;++show (vdlbl vd)++&quot; &quot;++showHSName (vdcpt vd)</span>
<span class="lineno">  567 </span><span class="spaces">    </span><span class="nottickedoff">++indent++&quot;  [ &quot;++intercalate (indent++&quot;  , &quot;) (map (showHS opts indent) $ vdats vd)++indent++&quot;  ]&quot;</span></span>
<span class="lineno">  568 </span>
<span class="lineno">  569 </span>--instance ShowHSName ViewSegment where
<span class="lineno">  570 </span>-- showHSName vd = haskellIdentifier (&quot;vdef_&quot;++name vd)
<span class="lineno">  571 </span>
<span class="lineno">  572 </span>instance ShowHS ViewSegment where
<span class="lineno">  573 </span> <span class="decl"><span class="nottickedoff">showHS _     _      (ViewText str)   = &quot;ViewText &quot;++show str</span>
<span class="lineno">  574 </span><span class="spaces"> </span><span class="nottickedoff">showHS _     _      (ViewHtml str)   = &quot;ViewHtml &quot;++show str</span>
<span class="lineno">  575 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (ViewExp objDef) = &quot;ViewExp &quot;++ showHS opts (indent++&quot;            &quot;) objDef</span></span>
<span class="lineno">  576 </span>
<span class="lineno">  577 </span>instance ShowHS Population where
<span class="lineno">  578 </span> <span class="decl"><span class="nottickedoff">showHS _ indent pop</span>
<span class="lineno">  579 </span><span class="spaces">  </span><span class="nottickedoff">= case pop of</span>
<span class="lineno">  580 </span><span class="spaces">      </span><span class="nottickedoff">PRelPopu{} -&gt; &quot;PRelPopu { popdcl = &quot;++showHSName (popdcl pop)</span>
<span class="lineno">  581 </span><span class="spaces">          </span><span class="nottickedoff">++indent++&quot;         , popps  = [ &quot;++intercalate</span>
<span class="lineno">  582 </span><span class="spaces">           </span><span class="nottickedoff">(indent++&quot;                    , &quot;) (map show (popps pop))</span>
<span class="lineno">  583 </span><span class="spaces">          </span><span class="nottickedoff">++indent++&quot;                    ]&quot;</span>
<span class="lineno">  584 </span><span class="spaces">          </span><span class="nottickedoff">++indent++&quot;         }&quot;</span>
<span class="lineno">  585 </span><span class="spaces">      </span><span class="nottickedoff">PCptPopu{} -&gt; &quot;PCptPopu { popcpt = &quot;++showHSName (popcpt pop)</span>
<span class="lineno">  586 </span><span class="spaces">          </span><span class="nottickedoff">++indent++&quot;         , popas  = [ &quot;++intercalate</span>
<span class="lineno">  587 </span><span class="spaces">           </span><span class="nottickedoff">(indent++&quot;                    , &quot;) (map show (popas pop))</span>
<span class="lineno">  588 </span><span class="spaces">          </span><span class="nottickedoff">++indent++&quot;                    ]&quot;</span>
<span class="lineno">  589 </span><span class="spaces">          </span><span class="nottickedoff">++indent++&quot;         }&quot;</span></span>
<span class="lineno">  590 </span>
<span class="lineno">  591 </span>instance ShowHSName ObjectDef where
<span class="lineno">  592 </span> <span class="decl"><span class="nottickedoff">showHSName obj = haskellIdentifier (&quot;oDef_&quot;++name obj)</span></span>
<span class="lineno">  593 </span>
<span class="lineno">  594 </span>instance ShowHS ObjectDef where
<span class="lineno">  595 </span> <span class="decl"><span class="nottickedoff">showHS opts indent r</span>
<span class="lineno">  596 </span><span class="spaces">  </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  597 </span><span class="spaces">        </span><span class="nottickedoff">[&quot;Obj{ objnm   = &quot; ++ show(objnm r)</span>
<span class="lineno">  598 </span><span class="spaces">        </span><span class="nottickedoff">,&quot;   , objpos  = &quot; ++ showHS opts &quot;&quot; (objpos r)</span>
<span class="lineno">  599 </span><span class="spaces">        </span><span class="nottickedoff">,&quot;   , objctx  = &quot; ++ showHS opts (indent++&quot;               &quot;) (objctx r)</span>
<span class="lineno">  600 </span><span class="spaces">        </span><span class="nottickedoff">,&quot;   , objmsub = &quot; ++ showHS opts (indent++&quot;                    &quot;) (objmsub r)</span>
<span class="lineno">  601 </span><span class="spaces">        </span><span class="nottickedoff">,&quot;   , objstrs = &quot; ++ show(objstrs r)</span>
<span class="lineno">  602 </span><span class="spaces">        </span><span class="nottickedoff">]++indent++&quot;   }&quot;</span></span>
<span class="lineno">  603 </span>
<span class="lineno">  604 </span>instance ShowHSName Interface where
<span class="lineno">  605 </span> <span class="decl"><span class="nottickedoff">showHSName obj = haskellIdentifier (&quot;ifc_&quot;++name obj)</span></span>
<span class="lineno">  606 </span>
<span class="lineno">  607 </span>instance ShowHS Interface where
<span class="lineno">  608 </span> <span class="decl"><span class="nottickedoff">showHS opts indent ifc</span>
<span class="lineno">  609 </span><span class="spaces">  </span><span class="nottickedoff">= intercalate indent</span>
<span class="lineno">  610 </span><span class="spaces">        </span><span class="nottickedoff">[ &quot;Ifc { ifcClass = &quot; ++ show (ifcClass ifc) </span>
<span class="lineno">  611 </span><span class="spaces">        </span><span class="nottickedoff">, wrap &quot;    , ifcParams = &quot; (indent++&quot;                  &quot;) (showHS opts) (ifcParams ifc)</span>
<span class="lineno">  612 </span><span class="spaces">        </span><span class="nottickedoff">, &quot;    , ifcArgs   = &quot; ++ show(ifcArgs ifc)</span>
<span class="lineno">  613 </span><span class="spaces">        </span><span class="nottickedoff">, &quot;    , ifcRoles  = &quot; ++ show(ifcRoles ifc)</span>
<span class="lineno">  614 </span><span class="spaces">        </span><span class="nottickedoff">, &quot;    , ifcObj&quot;++indent++&quot;       = &quot; ++ showHS opts (indent++&quot;         &quot;) (ifcObj ifc)</span>
<span class="lineno">  615 </span><span class="spaces">        </span><span class="nottickedoff">, &quot;    , ifcEcas   = &quot; ++ showHS opts (indent++&quot;                 &quot;) (ifcEcas ifc)</span>
<span class="lineno">  616 </span><span class="spaces">        </span><span class="nottickedoff">, wrap &quot;    , ifcControls = &quot; (indent++&quot;                  &quot;) (\_-&gt;showHSName) (ifcControls ifc)</span>
<span class="lineno">  617 </span><span class="spaces">        </span><span class="nottickedoff">, &quot;    , ifcPos    = &quot; ++ showHS opts &quot;&quot; (ifcPos ifc)</span>
<span class="lineno">  618 </span><span class="spaces">        </span><span class="nottickedoff">, &quot;    , ifcPrp    = &quot; ++ show(ifcPrp ifc)</span>
<span class="lineno">  619 </span><span class="spaces">        </span><span class="nottickedoff">]++indent++&quot;    }&quot;</span></span>
<span class="lineno">  620 </span>
<span class="lineno">  621 </span>instance ShowHS SubInterface where
<span class="lineno">  622 </span> <span class="decl"><span class="nottickedoff">showHS _     _      (InterfaceRef n) = &quot;InterfaceRef &quot;++show n</span>
<span class="lineno">  623 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (Box x cl objs) = &quot;Box (&quot;++showHS opts indent x++&quot;) (&quot;++showHS opts indent cl++&quot;)&quot;++indent++&quot;     (&quot;++showHS opts (indent++&quot;     &quot;) objs++&quot;)&quot;</span></span>
<span class="lineno">  624 </span>
<span class="lineno">  625 </span>instance ShowHS Expression where
<span class="lineno">  626 </span> <span class="decl"><span class="nottickedoff">showHS opts indent (EEqu (l,r)) = &quot;EEqu (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  627 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EImp (l,r)) = &quot;EImp (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  628 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EIsc (l,r)) = &quot;EIsc (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  629 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EUni (l,r)) = &quot;EUni (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  630 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EDif (l,r)) = &quot;EDif (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  631 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (ELrs (l,r)) = &quot;ELrs (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  632 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (ERrs (l,r)) = &quot;ERrs (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  633 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EDia (l,r)) = &quot;EDia (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  634 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (ECps (l,r)) = &quot;ECps (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  635 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (ERad (l,r)) = &quot;ERad (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  636 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EPrd (l,r)) = &quot;EPrd (&quot;++showHS opts (indent++&quot;      &quot;) l++indent++&quot;     ,&quot;++showHS opts (indent++&quot;      &quot;) r++indent++&quot;     )&quot;</span>
<span class="lineno">  637 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EKl0 e    ) = &quot;EKl0 (&quot;++showHS opts (indent++&quot;      &quot;) e++&quot;)&quot;</span>
<span class="lineno">  638 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EKl1 e    ) = &quot;EKl1 (&quot;++showHS opts (indent++&quot;      &quot;) e++&quot;)&quot;</span>
<span class="lineno">  639 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EFlp e    ) = &quot;EFlp (&quot;++showHS opts (indent++&quot;      &quot;) e++&quot;)&quot;</span>
<span class="lineno">  640 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (ECpl e    ) = &quot;ECpl (&quot;++showHS opts (indent++&quot;      &quot;) e++&quot;)&quot;</span>
<span class="lineno">  641 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts indent (EBrk e    ) = &quot;EBrk (&quot;++showHS opts (indent++&quot;      &quot;) e++&quot;)&quot;</span>
<span class="lineno">  642 </span><span class="spaces"> </span><span class="nottickedoff">showHS _    _      (EDcD dcl  ) = &quot;EDcD &quot;++showHSName dcl</span>
<span class="lineno">  643 </span><span class="spaces"> </span><span class="nottickedoff">showHS _    _      (EDcI c    ) = &quot;EDcI &quot;++showHSName c</span>
<span class="lineno">  644 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts _      (EEps i sgn) = &quot;EEps (&quot;++showHS opts &quot;&quot; i++&quot;) (&quot;++showHS opts &quot;&quot; sgn++&quot;)&quot;</span>
<span class="lineno">  645 </span><span class="spaces"> </span><span class="nottickedoff">showHS opts _      (EDcV sgn  ) = &quot;EDcV (&quot;++showHS opts &quot;&quot; sgn++&quot;)&quot;</span>
<span class="lineno">  646 </span><span class="spaces"> </span><span class="nottickedoff">showHS _    _      (EMp1 a c  ) = &quot;EMp1 &quot; ++show a++&quot; &quot;++showHSName c</span></span>
<span class="lineno">  647 </span>
<span class="lineno">  648 </span>instance ShowHS Sign where
<span class="lineno">  649 </span> <span class="decl"><span class="nottickedoff">showHS _ _ sgn = &quot;Sign &quot;++showHSName (source sgn)++&quot; &quot;++showHSName (target sgn)</span></span>
<span class="lineno">  650 </span>
<span class="lineno">  651 </span>instance ShowHS A_Gen where
<span class="lineno">  652 </span> <span class="decl"><span class="nottickedoff">showHS _ _ gen =</span>
<span class="lineno">  653 </span><span class="spaces">   </span><span class="nottickedoff">case gen of</span>
<span class="lineno">  654 </span><span class="spaces">     </span><span class="nottickedoff">Isa{} -&gt; &quot;Isa &quot;++showHSName (genspc gen)++&quot; &quot;++showHSName (gengen gen)++&quot; &quot;</span>
<span class="lineno">  655 </span><span class="spaces">     </span><span class="nottickedoff">IsE{} -&gt; &quot;IsE &quot;++showHSName (genspc gen)++&quot; [&quot;++intercalate &quot;, &quot; (map showHSName (genrhs gen))++&quot;] &quot;</span></span>
<span class="lineno">  656 </span>
<span class="lineno">  657 </span>instance ShowHSName Declaration where
<span class="lineno">  658 </span> <span class="decl"><span class="nottickedoff">showHSName d@Isn{}       = haskellIdentifier (&quot;rel_&quot;++name d++&quot;_&quot;++name (source d)) -- identity relation</span>
<span class="lineno">  659 </span><span class="spaces"> </span><span class="nottickedoff">showHSName d@Vs{}        = haskellIdentifier (&quot;rel_&quot;++name d++&quot;_&quot;++name (source d)++&quot;_&quot;++name (target d)) -- full relation</span>
<span class="lineno">  660 </span><span class="spaces"> </span><span class="nottickedoff">showHSName d | decusr d  = haskellIdentifier (&quot;rel_&quot;++name d++&quot;_&quot;++name (source d)++&quot;_&quot;++name (target d)) -- user defined relations</span>
<span class="lineno">  661 </span><span class="spaces">              </span><span class="nottickedoff">| deciss d  = haskellIdentifier (&quot;sgn_&quot;++name d++&quot;_&quot;++name (source d)++&quot;_&quot;++name (target d)) -- relations generated for signalling</span>
<span class="lineno">  662 </span><span class="spaces">              </span><span class="nottickedoff">| otherwise = haskellIdentifier (&quot;vio_&quot;++name d++&quot;_&quot;++name (source d)++&quot;_&quot;++name (target d))</span></span> -- relations generated per rule
<span class="lineno">  663 </span>
<span class="lineno">  664 </span>instance ShowHS Declaration where
<span class="lineno">  665 </span> <span class="decl"><span class="nottickedoff">showHS opts indent d</span>
<span class="lineno">  666 </span><span class="spaces">    </span><span class="nottickedoff">= case d of</span>
<span class="lineno">  667 </span><span class="spaces">       </span><span class="nottickedoff">Sgn{}     -&gt; intercalate indent</span>
<span class="lineno">  668 </span><span class="spaces">                     </span><span class="nottickedoff">[&quot;Sgn{ decnm   = &quot; ++ show (decnm d)</span>
<span class="lineno">  669 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decsgn  = &quot; ++ showHS opts &quot;&quot; (sign d)</span>
<span class="lineno">  670 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decprps = &quot; ++ showL(map (showHS opts &quot;&quot;) (decprps d))</span>
<span class="lineno">  671 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decprps_calc = &quot; ++ case decprps_calc d of</span>
<span class="lineno">  672 </span><span class="spaces">                                                 </span><span class="nottickedoff">Nothing -&gt; &quot;Nothing&quot;</span>
<span class="lineno">  673 </span><span class="spaces">                                                 </span><span class="nottickedoff">Just ps -&gt; &quot;Just &quot;++showL(map (showHS opts &quot;&quot;) ps)</span>
<span class="lineno">  674 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decprL  = &quot; ++ show (decprL d)</span>
<span class="lineno">  675 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decprM  = &quot; ++ show (decprM d)</span>
<span class="lineno">  676 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decprR  = &quot; ++ show (decprR d)</span>
<span class="lineno">  677 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decMean = &quot; ++ show (decMean d)</span>
<span class="lineno">  678 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decfpos = &quot; ++ showHS opts &quot;&quot; (decfpos d)</span>
<span class="lineno">  679 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , deciss  = &quot; ++ show (deciss d)</span>
<span class="lineno">  680 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decusr  = &quot; ++ show (decusr d)</span>
<span class="lineno">  681 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decpat  = &quot; ++ show (decpat d)</span>
<span class="lineno">  682 </span><span class="spaces">                     </span><span class="nottickedoff">,&quot;   , decplug = &quot; ++ show (decplug d)</span>
<span class="lineno">  683 </span><span class="spaces">                     </span><span class="nottickedoff">]++&quot;}&quot;</span>
<span class="lineno">  684 </span><span class="spaces">       </span><span class="nottickedoff">Isn{}     -&gt; &quot;Isn{ detyp   = &quot; ++ showHSName (detyp d)++&quot;}&quot;</span>
<span class="lineno">  685 </span><span class="spaces">       </span><span class="nottickedoff">Vs{}      -&gt; &quot;Vs { decsgn  = &quot; ++ showHS opts &quot;&quot; (sign d)++&quot;}&quot;</span></span>
<span class="lineno">  686 </span>
<span class="lineno">  687 </span>--   instance ShowHSName ConceptDef where
<span class="lineno">  688 </span>--    showHSName cd = haskellIdentifier (&quot;cDef_&quot;++cdcpt cd)
<span class="lineno">  689 </span>
<span class="lineno">  690 </span>instance ShowHS ConceptDef where
<span class="lineno">  691 </span> <span class="decl"><span class="nottickedoff">showHS opts _ cd</span>
<span class="lineno">  692 </span><span class="spaces">  </span><span class="nottickedoff">= &quot; Cd (&quot;++showHS opts &quot;&quot; (cdpos cd)++&quot;) &quot;++show (cdcpt cd)++&quot; &quot;++show (cdplug cd)++&quot; &quot;++show (cddef cd)++&quot; &quot;++show (cdtyp cd)++&quot; &quot;++show (cdref cd)++&quot; &quot;++show (cdfrom cd)</span></span>
<span class="lineno">  693 </span>instance ShowHSName Char where
<span class="lineno">  694 </span> <span class="decl"><span class="nottickedoff">showHSName c = show c</span></span>
<span class="lineno">  695 </span>instance ShowHS Char where
<span class="lineno">  696 </span> <span class="decl"><span class="nottickedoff">showHS _ _ c = show c</span></span>
<span class="lineno">  697 </span>instance ShowHSName A_Concept where
<span class="lineno">  698 </span> <span class="decl"><span class="nottickedoff">showHSName ONE = haskellIdentifier &quot;cptOne&quot;</span>
<span class="lineno">  699 </span><span class="spaces"> </span><span class="nottickedoff">showHSName c = haskellIdentifier (&quot;cpt_&quot;++name c)</span></span>
<span class="lineno">  700 </span>instance ShowHS A_Concept where
<span class="lineno">  701 </span> <span class="decl"><span class="nottickedoff">showHS _ _ c = case c of</span>
<span class="lineno">  702 </span><span class="spaces">                    </span><span class="nottickedoff">PlainConcept{} -&gt; &quot;PlainConcept &quot;++show (name c)</span>
<span class="lineno">  703 </span><span class="spaces">                    </span><span class="nottickedoff">ONE -&gt; &quot;ONE&quot;</span></span>
<span class="lineno">  704 </span>
<span class="lineno">  705 </span>instance ShowHSName Prop where
<span class="lineno">  706 </span> <span class="decl"><span class="nottickedoff">showHSName Uni = &quot;Uni&quot;</span>
<span class="lineno">  707 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Inj = &quot;Inj&quot;</span>
<span class="lineno">  708 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Sur = &quot;Sur&quot;</span>
<span class="lineno">  709 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Tot = &quot;Tot&quot;</span>
<span class="lineno">  710 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Sym = &quot;Sym&quot;</span>
<span class="lineno">  711 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Asy = &quot;Asy&quot;</span>
<span class="lineno">  712 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Trn = &quot;Trn&quot;</span>
<span class="lineno">  713 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Rfx = &quot;Rfx&quot;</span>
<span class="lineno">  714 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Irf = &quot;Irf&quot;</span>
<span class="lineno">  715 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Aut = &quot;Aut&quot;</span>
<span class="lineno">  716 </span><span class="spaces"> </span><span class="nottickedoff">showHSName Prop = &quot;Prop&quot;</span></span>
<span class="lineno">  717 </span>
<span class="lineno">  718 </span>instance ShowHS Prop where
<span class="lineno">  719 </span> <span class="decl"><span class="nottickedoff">showHS _ _ = showHSName</span></span>
<span class="lineno">  720 </span>
<span class="lineno">  721 </span>instance ShowHS FilePos where
<span class="lineno">  722 </span> <span class="decl"><span class="nottickedoff">showHS _ _ pos = show pos</span></span>
<span class="lineno">  723 </span>
<span class="lineno">  724 </span>instance ShowHSName Origin where
<span class="lineno">  725 </span> <span class="decl"><span class="nottickedoff">showHSName ori = &quot;Orig&quot;++show x++show (hash x)</span>
<span class="lineno">  726 </span><span class="spaces">   </span><span class="nottickedoff">where x :: String</span>
<span class="lineno">  727 </span><span class="spaces">         </span><span class="nottickedoff">x = case ori of</span>
<span class="lineno">  728 </span><span class="spaces">              </span><span class="nottickedoff">FileLoc l sym -&gt; &quot;FileLoc (&quot; ++ show l ++ &quot; &quot; ++ sym ++ &quot;)&quot;</span>
<span class="lineno">  729 </span><span class="spaces">              </span><span class="nottickedoff">DBLoc l       -&gt; &quot;DBLoc &quot; ++ show l</span>
<span class="lineno">  730 </span><span class="spaces">              </span><span class="nottickedoff">Origin s      -&gt; &quot;Origin &quot; ++ show s</span>
<span class="lineno">  731 </span><span class="spaces">              </span><span class="nottickedoff">OriginUnknown -&gt; &quot;OriginUnknown&quot;</span></span>
<span class="lineno">  732 </span>
<span class="lineno">  733 </span>instance ShowHS Origin where
<span class="lineno">  734 </span> <span class="decl"><span class="nottickedoff">showHS opts indent (FileLoc l s) = &quot;FileLoc (&quot; ++ showHS opts indent l ++ &quot; &quot; ++ s ++ &quot;)&quot;</span>
<span class="lineno">  735 </span><span class="spaces"> </span><span class="nottickedoff">showHS _     _      (DBLoc l)    = &quot;DBLoc &quot;  ++ show l</span>
<span class="lineno">  736 </span><span class="spaces"> </span><span class="nottickedoff">showHS _     _      (Origin s)   = &quot;Origin &quot; ++ show s</span>
<span class="lineno">  737 </span><span class="spaces"> </span><span class="nottickedoff">showHS _     _    OriginUnknown  = &quot;OriginUnknown&quot;</span></span>
<span class="lineno">  738 </span>
<span class="lineno">  739 </span>instance ShowHS Block where
<span class="lineno">  740 </span> <span class="decl"><span class="nottickedoff">showHS _ _   = show</span></span>
<span class="lineno">  741 </span>
<span class="lineno">  742 </span>instance ShowHS Inline where
<span class="lineno">  743 </span> <span class="decl"><span class="nottickedoff">showHS _ _   = show</span></span>
<span class="lineno">  744 </span>                  
<span class="lineno">  745 </span>{-
<span class="lineno">  746 </span>instance ShowHS InfTree where
<span class="lineno">  747 </span> showHS opts indent itree =
<span class="lineno">  748 </span>     case itree of
<span class="lineno">  749 </span>       InfExprs irt (ratype,raobj) itrees -&gt;
<span class="lineno">  750 </span>           &quot;InfExprs &quot; ++ showHS opts indent irt ++
<span class="lineno">  751 </span>           indent ++ &quot;   (&quot; ++ showRaType ratype ++ &quot;,&quot; ++ &quot;RelAlgObj{-&quot;++show raobj++&quot;-}&quot; ++ &quot;)&quot; ++
<span class="lineno">  752 </span>           indent ++ showHS opts (indent ++ &quot;     &quot;) itrees
<span class="lineno">  753 </span>       InfRel drt ratype _ _ -&gt;
<span class="lineno">  754 </span>           &quot;InfRel &quot; ++ showHS opts indent drt ++ &quot; &quot; ++ showRaType ratype
<span class="lineno">  755 </span>   where
<span class="lineno">  756 </span>    showRaType rat = &quot;RelAlgType{-&quot;++show rat++&quot;-}&quot;
<span class="lineno">  757 </span>
<span class="lineno">  758 </span>instance ShowHS RelDecl where
<span class="lineno">  759 </span> showHS _ indent d = case d of
<span class="lineno">  760 </span>                       RelDecl{}-&gt; &quot;RelDecl{ dname  = &quot; ++ show (dname d) ++ indent
<span class="lineno">  761 </span>                                ++ &quot;        ,dtype  = &quot; ++ showRaType dtype ++ indent
<span class="lineno">  762 </span>                                ++ &quot;        ,isendo = &quot; ++ show (isendo d)
<span class="lineno">  763 </span>                       IDecl    -&gt; &quot;IDecl&quot;
<span class="lineno">  764 </span>                       VDecl    -&gt; &quot;VDecl&quot;
<span class="lineno">  765 </span>   where
<span class="lineno">  766 </span>    showRaType _ = &quot;RelAlgType{- ++TODO++ -}&quot;
<span class="lineno">  767 </span>
<span class="lineno">  768 </span>
<span class="lineno">  769 </span>instance ShowHS DeclRuleType where
<span class="lineno">  770 </span> showHS _ _ drt = case drt of
<span class="lineno">  771 </span>                                      D_rel     -&gt; &quot;D_rel&quot;
<span class="lineno">  772 </span>                                      D_rel_h   -&gt; &quot;D_rel_h&quot;
<span class="lineno">  773 </span>                                      D_rel_c   -&gt; &quot;D_rel_c&quot;
<span class="lineno">  774 </span>                                      D_rel_c_h -&gt; &quot;D_rel_c_h&quot;
<span class="lineno">  775 </span>                                      D_id      -&gt; &quot;D_id&quot;
<span class="lineno">  776 </span>                                      D_v       -&gt; &quot;D_v&quot;
<span class="lineno">  777 </span>                                      D_id_c    -&gt; &quot;D_id_c&quot;
<span class="lineno">  778 </span>                                      D_v_c     -&gt; &quot;D_v_c&quot;
<span class="lineno">  779 </span>
<span class="lineno">  780 </span>instance ShowHS InfRuleType where
<span class="lineno">  781 </span> showHS _ _ irt = case irt of
<span class="lineno">  782 </span>                                      ISect_cs  -&gt; &quot;ISect_cs&quot;
<span class="lineno">  783 </span>                                      ISect_ncs -&gt; &quot;ISect_ncs&quot;
<span class="lineno">  784 </span>                                      ISect_mix -&gt; &quot;ISect_mix&quot;
<span class="lineno">  785 </span>                                      Union_mix -&gt; &quot;Union_mix&quot;
<span class="lineno">  786 </span>                                      Comp_ncs  -&gt; &quot;Comp_ncs&quot;
<span class="lineno">  787 </span>                                      Comp_c1   -&gt; &quot;Comp_c1&quot;
<span class="lineno">  788 </span>                                      Comp_c2   -&gt; &quot;Comp_c2&quot;
<span class="lineno">  789 </span>                                      Comp_cs   -&gt; &quot;Comp_cs&quot;
<span class="lineno">  790 </span>                                      RAdd_ncs  -&gt; &quot;RAdd_ncs&quot;
<span class="lineno">  791 </span>                                      RAdd_c1   -&gt; &quot;RAdd_c1&quot;
<span class="lineno">  792 </span>                                      RAdd_c2   -&gt; &quot;RAdd_c2&quot;
<span class="lineno">  793 </span>                                      RAdd_cs   -&gt; &quot;RAdd_cs&quot;
<span class="lineno">  794 </span>                                      Conv_nc   -&gt; &quot;Conv_nc&quot;
<span class="lineno">  795 </span>                                      Conv_c    -&gt; &quot;Conv_c&quot;
<span class="lineno">  796 </span>-}
<span class="lineno">  797 </span>
<span class="lineno">  798 </span>-- \***********************************************************************
<span class="lineno">  799 </span>-- \*** hulpfuncties                                                    ***
<span class="lineno">  800 </span>-- \***********************************************************************
<span class="lineno">  801 </span>
<span class="lineno">  802 </span>haskellIdentifier :: String -&gt; String
<span class="lineno">  803 </span><span class="decl"><span class="nottickedoff">haskellIdentifier cs = unCap (hsId cs)</span>
<span class="lineno">  804 </span><span class="spaces"> </span><span class="nottickedoff">where</span>
<span class="lineno">  805 </span><span class="spaces">   </span><span class="nottickedoff">hsId ('_': cs')             = '_': hsId cs'</span>
<span class="lineno">  806 </span><span class="spaces">   </span><span class="nottickedoff">hsId (c:cs') | isAlphaNum c = c: hsId cs'</span>
<span class="lineno">  807 </span><span class="spaces">                </span><span class="nottickedoff">| otherwise    = hsId cs'</span>
<span class="lineno">  808 </span><span class="spaces">   </span><span class="nottickedoff">hsId &quot;&quot;                     = &quot;&quot;</span></span>
<span class="lineno">  809 </span>
<span class="lineno">  810 </span>showL :: [String] -&gt; String
<span class="lineno">  811 </span><span class="decl"><span class="nottickedoff">showL xs = &quot;[&quot;++intercalate &quot;,&quot; xs++&quot;]&quot;</span></span>

</pre>
</body>
</html>
